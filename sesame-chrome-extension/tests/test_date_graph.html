<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="../../jsunit/css/jsUnitStyle.css">
    <script type="text/javascript" src="../../jsunit/app/jsUnitCore.js"></script>

    <script type="text/javascript" src="../lib/graph_utils.js"></script>
    <script type="text/javascript" src="../lib/data_graph.js"></script>
    <script type="text/javascript" src="../lib/client_stack.js"></script>
    <script type="text/javascript" src="../lib/date_utils.js"></script>
    <script type="text/javascript">

        function testConstruct() {
        	var data_graph = new DataGraph()
            assertNotNull("object created", data_graph);
        }

        function testAddPoints() {
        	var data_graph = new DataGraph(10, 20)
        	data_graph.add_point(10, 100);
        	data_graph.add_point(20, 200);
        	assertEquals("BkDI", data_graph.get_chart_data());
        }

        function testGranularity() {
        	{
	        	var data_graph = new DataGraph(5, 20)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	data_graph.add_point(15, 100);
	        	data_graph.add_point(17, 50);
	        	assertEquals("DIBk", data_graph.get_chart_data());
	        }
        	{
	        	var data_graph = new DataGraph(5, 20)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(20, 200);
	        	data_graph.add_point(30, 100);
	        	data_graph.add_point(40, 50);
	        	assertEquals("Bk__DI__Bk__Ay", data_graph.get_chart_data());
	        }
        	{
	        	var data_graph = new DataGraph(1, 20)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(20, 200);
	        	assertEquals("Bk__________________DI", data_graph.get_chart_data());
	        }
        }

        function testMaxLength() {
        	{
	        	var data_graph = new DataGraph(2, 2)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	data_graph.add_point(15, 100);
	        	data_graph.add_point(17, 50);
	        	assertEquals("BkAy", data_graph.get_chart_data());
	        }
        }

        function testGetChartSettings() {
        	{
	        	var data_graph = new DataGraph(2, 2)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	data_graph.add_point(15, 98);
	        	data_graph.add_point(17, 50);
	        	var settings = data_graph.get_chart_settings();
	        	assertEquals(100, settings.max);
	        	assertEquals("-tf.", settings.data);
	        }
        	{
	        	var data_graph = new DataGraph(2, 2)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	var settings = data_graph.get_chart_settings();
	        	assertEquals(205, settings.max);
	        	assertEquals("fN-b", settings.data);
	        }
        }

        function testGoogleChartEncode() {
        	assertEquals("encode 0", "AA", GraphUtils.google_chart_encode(0) );
        	assertEquals("encode 0", "BA", GraphUtils.google_chart_encode(64) );
        	assertEquals("encode 0", "-g", GraphUtils.google_chart_encode(4000) );
        }
        
        function testTwoDimensionGraph() {
        	var data_graph = new DataGraph(5, 20, 2)
        	data_graph.add_point(10, 100, 200);
        	data_graph.add_point(15, 100, 50);
        	assertEquals("BkBk,DIAy", data_graph.get_chart_data());
        }
        
        function testGetCurrentSeconds() {
        	assert(getCurrentSeconds()>0);
        	//console.log(getCurrentSeconds());
        }
        
        function testClientStack() {
        	{
        		var client_stack = new ClientStack(10);
        		client_stack.add_processing_clients(
        			10,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 0 }
        			}
        		);
        		client_stack.add_processing_clients(
        			20,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 1 }
        			}
        		);
        		client_stack.add_processing_clients(
        			30,
        			{
        			}
        		);
	        	assertEquals(
	        		"client_stack: calculate processed list", 
	        		"10,20", 
	        		client_stack.get_all_processing_time_time().join(',')
	        	);
        	}
        	{
        		var client_stack = new ClientStack(10);
        		client_stack.add_processing_clients(
        			10,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 0 }
        			}
        		);
        		client_stack.add_processing_clients(
        			20,
        			{
        				'o22': { 'is_active': 0 },
        				'o45': { 'is_active': 1 }
        			}
        		);
	        	assertEquals(
	        		"client_stack: mark processed client", 
	        		"10", 
	        		client_stack.get_all_processing_time_time().join(',')
	        	);
        	}
        	{
        		var client_stack = new ClientStack(1);
        		client_stack.add_processing_clients(
        			10,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 0 }
        			}
        		);
        		client_stack.add_processing_clients(
        			20,
        			{
        				'o22': { 'is_active': 0 },
        				'o45': { 'is_active': 1 }
        			}
        		);
        		client_stack.add_processing_clients(
        			40,
        			{
        			}
        		);
	        	assertEquals(
	        		"client_stack: limit number of processed clients", 
	        		"20", 
	        		client_stack.get_all_processing_time_time().join(',')
	        	);
        	}
        }

    </script>
</head>

<body>
<h1>Testing sesame_support_helper</h1>

<p>This page contains failing and erroring tests. It exists for developers of the framework to experiment with.</p>
</body>
</html>
