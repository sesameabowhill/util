<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/qunit/qunit-git.css">
    <script type="text/javascript" src="http://code.jquery.com/qunit/qunit-git.js"></script>

    <script type="text/javascript" src="../lib/graph_utils.js"></script>
    <script type="text/javascript" src="../lib/data_graph.js"></script>
    <script type="text/javascript" src="../lib/client_stack.js"></script>
    <script type="text/javascript" src="../lib/date_utils.js"></script>
    <script type="text/javascript">

        test("testConstruct", function () {
        	var data_graph = new DataGraph();
                notEqual(data_graph, null, "object created");
        });

        test("testAddPoints", function () {
        	var data_graph = new DataGraph(10, 20)
        	data_graph.add_point(10, 100);
        	data_graph.add_point(20, 200);
        	equal("BkDI", data_graph.get_chart_data());
        });

        test("testGranularity", function () {
        	{
	        	var data_graph = new DataGraph(5, 20)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	data_graph.add_point(15, 100);
	        	data_graph.add_point(17, 50);
	        	equal("DIBk", data_graph.get_chart_data());
	        }
        	{
	        	var data_graph = new DataGraph(5, 20)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(20, 200);
	        	data_graph.add_point(30, 100);
	        	data_graph.add_point(40, 50);
	        	equal("Bk__DI__Bk__Ay", data_graph.get_chart_data());
	        }
        	{
	        	var data_graph = new DataGraph(1, 20)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(20, 200);
	        	equal("Bk__________________DI", data_graph.get_chart_data());
	        }
        });

        test("testMaxLength", function () {
        	{
	        	var data_graph = new DataGraph(2, 2)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	data_graph.add_point(15, 100);
	        	data_graph.add_point(17, 50);
	        	equal("BkAy", data_graph.get_chart_data());
	        }
        });

        test("testGetChartSettings", function () {
        	{
	        	var data_graph = new DataGraph(2, 2)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	data_graph.add_point(15, 98);
	        	data_graph.add_point(17, 50);
	        	var settings = data_graph.get_chart_settings();
	        	equal(100, settings.max);
	        	equal("-tf.", settings.data);
	        }
        	{
	        	var data_graph = new DataGraph(2, 2)
	        	data_graph.add_point(10, 100);
	        	data_graph.add_point(12, 200);
	        	var settings = data_graph.get_chart_settings();
	        	equal(205, settings.max);
	        	equal("fN-b", settings.data);
	        }
        });

        test("testGoogleChartEncode", function () {
        	equal("AA", GraphUtils.google_chart_encode(0), "encode 0");
        	equal("BA", GraphUtils.google_chart_encode(64), "encode 64" );
        	equal("-g", GraphUtils.google_chart_encode(4000), "encode 4000" );
        });
        
        test("testTwoDimensionGraph", function () {
        	var data_graph = new DataGraph(5, 20, 2)
        	data_graph.add_point(10, 100, 200);
        	data_graph.add_point(15, 100, 50);
        	equal("BkBk,DIAy", data_graph.get_chart_data());
        });
        
        test("testGetCurrentSeconds", function () {
        	ok(getCurrentSeconds()>0);
        	//console.log(getCurrentSeconds());
        });
        
        test("testClientStack", function () {
        	{
        		var client_stack = new ClientStack(10);
        		client_stack.add_processing_clients(
        			10,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 0 }
        			}
        		);
        		client_stack.add_processing_clients(
        			20,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 1 }
        			}
        		);
        		client_stack.add_processing_clients(
        			30,
        			{
        			}
        		);
	        	equal(
	        		client_stack.get_all_processing_time_time().join(','),
	        		"10,20", 
	        		"client_stack: calculate processed list"
	        	);
        	}
        	{
        		var client_stack = new ClientStack(10);
        		client_stack.add_processing_clients(
        			10,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 0 }
        			}
        		);
        		client_stack.add_processing_clients(
        			20,
        			{
        				'o22': { 'is_active': 0 },
        				'o45': { 'is_active': 1 }
        			}
        		);
	        	equal(
	        		client_stack.get_all_processing_time_time().join(','),
	        		"10", 
	        		"client_stack: mark processed client"
	        	);
        	}
        	{
        		var client_stack = new ClientStack(1);
        		client_stack.add_processing_clients(
        			10,
        			{
        				'o22': { 'is_active': 1 },
        				'o45': { 'is_active': 0 }
        			}
        		);
        		client_stack.add_processing_clients(
        			20,
        			{
        				'o22': { 'is_active': 0 },
        				'o45': { 'is_active': 1 }
        			}
        		);
        		client_stack.add_processing_clients(
        			40,
        			{
        			}
        		);
	        	equal(
	        		client_stack.get_all_processing_time_time().join(','),
	        		"20", 
	        		"client_stack: limit number of processed clients"
	        	);
        	}
        });

    </script>
</head>

<body>
  <h1 id="qunit-header">Sesame Chrome Extension</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture"></div>
</body>
</html>
